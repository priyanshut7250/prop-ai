import os
import logging
from google import genai

# Initialize Gemini client
client = genai.Client(api_key=os.environ.get("GEMINI_API_KEY", "default_key"))

def get_chat_response(user_message: str) -> str:
    """
    Get response from Gemini AI for the user's message
    
    Args:
        user_message (str): The user's input message
        
    Returns:
        str: AI response or error message
    """
    try:
        # Create a helpful system context for the PROP chatbot
        system_context = """You are PROP, a helpful and professional AI assistant. 
        You provide accurate, informative, and friendly responses to user questions. 
        Keep your responses concise but thorough, and maintain a professional yet 
        approachable tone. If you're unsure about something, be honest about it."""
        
        # Prepare the prompt with context
        prompt = f"{system_context}\n\nUser: {user_message}\n\nPROP:"
        
        # Generate response using Gemini
        response = client.models.generate_content(
            model="gemini-2.5-flash",
            contents=prompt
        )
        
        if response.text:
            return response.text.strip()
        else:
            return "I apologize, but I couldn't generate a response at the moment. Please try again."
            
    except Exception as e:
        logging.error(f"Error generating Gemini response: {str(e)}")
        return "I'm experiencing technical difficulties right now. Please try again in a moment."
